{% extends "cciw/standard.html" %}
{% load standardpage %}
{% load view_extras %}
{% block content %}

<h2>Recent</h2>
{% if object_list %}
{% regroup object_list by target as grouped %}
        {% for group in grouped %}
		<div class="tagdetail">
		{% if showtagtarget %}
		<span class="tagtitle">{{ group.list.0.render }}</span> 
		<span class="seealltags"><a class="tagcount" href="/tag_targets/{{ group.list.0.target_ct.name }}/{{ group.list.0.target_id }}/">View all tags</a> {% add_tag_link for group.list.0.target %}</span>
		<br/>
		{% endif %}
		&nbsp;Tagged 
		{% if showtagtext %}
			as {% for tag in group.list %}<span class="tag"><a href="/tags/{{ tag.text }}/">{{ tag.text }}</a></span> {% endfor %}
		{% endif %}
		{% if showtaggedby %}
			by {% memberlink %}{{ group.list.0.creator_id }}{% endmemberlink %} (<a title="Tags created by {{ group.list.0.creator_id }}" href="/members/{{ group.list.0.creator_id }}/tags/">tags</a>)
		{% endif %}
		
		<span class="tagtimesince">{{ group.list.0.added|timesince }} ago</span>
		{% if showtagcounts %}
			 <a class="tagcount" href="/tag_targets/{{ group.list.0.target_ct.name }}/{{ group.list.0.target_id }}/{{ group.list.0.text }}/" title="Details for tag '{{ group.list.0.text }}'">x{{ group.list.0.count_tagged_with_text }}</a>
		{% endif %}
		</div>
	{% endfor %}
{% else %}
	<p>No tags found.</p>
{% endif %}


<br/>
{% earlier_later %}
<br/>
<br/>

{% if not text %}
	{% if popular_tags %}
		{% if member %}
		<h2>Popular tags by {{ member.user_name }}</h2>
		{% else %}
		<h2>Popular</h2>
		{% endif %}
		{% for tag in popular_tags|dictsort:"text" %}
			<span class="tag weight{{ tag.weight }}"><a href="{{ tag_href_prefix }}{{ tag.text }}/">{{ tag.text }}</a></span>&nbsp;
		{% endfor %}
		<br/><br/>
	{% endif %}
{% endif %}

{% if popular_targets %}
	<h2>Popular items for '{{ text }}'</h2>
	<table class="tagtargets">
		<tr>
			<th scope="col">Item</th>
			<th scope="col">Count</th>
		</tr>
		{% for tagtarget in popular_targets %}
		<tr>
			<td><span class="tagtitle">{{ tagtarget.render }}</span></td>
			<td><a class="tagcount" href="/tag_targets/{{ tagtarget.target_ct.name }}/{{ tagtarget.target_id }}/{{ text }}/" title="Details for tag '{{ text }}'">x{{ tagtarget.count }}</a></td>
		</tr>
		{% endfor %}
	</table>

	<p><a href="/tag_search/?search={{ text }}">Show all...</a></p>
	<br/>
{% endif %}

{% if target %}
<h2>Links</h2>
<ul>
<li><a href="{{ target.get_absolute_url|escape }}">View '{{ target }}'</a></li>
<li>{% add_tag_link for target %} - add/edit tags for this item</li>
</ul>
<br/>
{% endif %}

<h2>Search tags</h2>
<div>
<form method='get' action='/tag_search/'>
<p><label>Text: <input type='text' name='search' id='search' /></label>
<input type="submit" name="go" value="Go" />
		</p>
	</form>
</div>


{% endblock %}
