{% extends "cciw/officers/base.html" %}
{% load adminmedia admin_modify reference_utils %}
{% block stylesheet %}{% admin_media_prefix %}css/forms.css{% endblock %}
{% block breadcrumbs %}{% endblock %}
{% block title %}Manage references{% endblock %}
{% block extrastyle %}{{ block.super }}
<script type="text/javascript">
<!--

function toggleAddress(ev) {
    var addrblock = ev.src().nextSibling;
    if (hasElementClass(addrblock, "hidden")) {
	removeElementClass(addrblock, "hidden");
    } else {
	addElementClass(addrblock, "hidden");
    }
}

function toggleRefControls(ev) {
    var refcontrols = ev.src().nextSibling;
    if (hasElementClass(refcontrols, "hidden")) {
	removeElementClass(refcontrols, "hidden");
    } else {
	addElementClass(refcontrols, "hidden");
    }
}


function addToggleHandlers(ev) {
    var elems = getElementsByTagAndClassName("div", "firstline");
    for (var i = 0; i < elems.length; i++) {
	connect(elems[i], 'onclick', toggleAddress);
    }
    elems = getElementsByTagAndClassName("div", "refdetails");
    for (var i = 0; i < elems.length; i++) {
	connect(elems[i], 'onclick', toggleRefControls);
    }
}

connect(window, 'onload', 
	function(ev) {
	    addToggleHandlers();
	}
)

//-->
</script>
{% endblock %}

{% block content %}<div id="content-main">

<h1>Manage references</h1>
<h2>For camp {{ camp }}</h2>

<p>This page allows you to manage references for officers who have
  submitted application forms.</p>

{% if message %}
  <p><strong>{{ message }}</strong></p>
{% endif %}

<h2>References</h2>
{% if application_forms %}
  <form action="" method="POST">
  <table>
    <tr>
      <th>Officer</th>
      <th>Referee 1</th>
      <th>Referee 2</th>
      <th>Last year - 1</th>
      <th>Last year - 2</th>
    </tr>

    {% for app, prevapp in application_forms %}
    {% with app.officer as officer %}
    <tr class="refrow">      
      <td>{{ officer.first_name }} {{ officer.last_name }}
	{% if app.ref1.received and app.ref2.received %}<strong class="good">Complete</stong>{% endif %}</td>
      <td>{{ app.referee1_name }}<br />
	{{ app.referee1_address|firstline }}
	{% if app.referee1_tel %}<div>{{ app.referee1_tel }}</div>{% endif %}
	{% if app.referee1_mobile %}<div>{{ app.referee1_mobile }}</div>{% endif %}
	{% if app.referee1_email %}<div>{{ app.referee1_email }}</div>{% endif %}
	<div class="refdetails">Reference:
	</div><div class="refcontrols hidden">
	  <label for="req_1_{{ app.id }}">Requested </label><input id="req_1_{{ app.id }}" name="req_1_{{ app.id }}" value="1" type="checkbox" {% if app.ref1.requested %}checked="checked"{% endif %} /><br />
	  <label for="rec_1_{{ app.id }}">Received <label><input id="rec_1_{{ app.id }}" name="rec_1_{{ app.id }}" value="1" type="checkbox"  {% if app.ref1.received %}checked="checked"{% endif %} /><br />
	  <label for="comments_1_{{ app.id }}">Comments</label><br />
	  <textarea name="comments_1_{{ app.id }}" id="comments_1_{{ app.id }}" cols="40" rows="4">{{ app.ref1.comments }}</textarea>
	</div>
      </td>
      <td>{{ app.referee2_name }}<br />
	{{ app.referee2_address|firstline }}
	{% if app.referee2_tel %}<div>{{ app.referee2_tel }}</div>{% endif %}
	{% if app.referee2_mobile %}<div>{{ app.referee2_mobile }}</div>{% endif %}
	{% if app.referee2_email %}<div>{{ app.referee2_email }}</div>{% endif %}
	<div class="refdetails">Reference:
	</div><div class="refcontrols hidden">
	  <label for="req_2_{{ app.id }}">Requested </label><input id="req_2_{{ app.id }}" name="req_2_{{ app.id }}" value="1" type="checkbox" {% if app.ref2.requested %}checked="checked"{% endif %} /><br />
	  <label for="rec_2_{{ app.id }}">Received <label><input id="rec_2_{{ app.id }}" name="rec_2_{{ app.id }}" value="1" type="checkbox"  {% if app.ref2.received %}checked="checked"{% endif %} /><br />
	  <label for="comments_2_{{ app.id }}">Comments</label><br />
	  <textarea name="comments_2_{{ app.id }}" id="comments_2_{{ app.id }}" cols="40" rows="4">{{ app.ref2.comments }}</textarea>
	</div>
      </td>
      <td>{{ prevapp.referee1_name }}<br />
	{{ prevapp.referee1_address|firstline }}
	{% if prevapp.referee1_tel %}<div>{{ prevapp.referee1_tel }}</div>{% endif %}
	{% if prevapp.referee1_mobile %}<div>{{ prevapp.referee1_mobile }}</div>{% endif %}
	{% if prevapp.referee1_email %}<div>{{ prevapp.referee1_email }}</div>{% endif %}
      </td>
      <td>{{ prevapp.referee2_name }}<br />
	{{ prevapp.referee2_address|firstline }}
	{% if prevapp.referee2_tel %}<div>{{ prevapp.referee2_tel }}</div>{% endif %}
	{% if prevapp.referee2_mobile %}<div>{{ prevapp.referee2_mobile }}</div>{% endif %}
	{% if prevapp.referee2_email %}<div>{{ prevapp.referee2_email }}</div>{% endif %}
      </td>
    </tr>
    {% endwith %}
    {% endfor %}
  </table>

  <input type="submit" name="save" value="Save" />
  </form>

{% else %}
  <p>No application forms completed yet.</p>

{% endif %}

</div>{% endblock %}
