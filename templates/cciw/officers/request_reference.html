{% extends "cciw/officers/base.html" %}
{% block title %}Request reference for {{ app.officer.first_name }} {{ app.officer.last_name }} | CCIW Officers {% endblock %}
{% block content %}
<div id="content-main">

<h2>Request reference for {{ app.officer.first_name }} {{ app.officer.last_name }}</h2>

<p>From referee: {{ referee.name }} {% if referee.email %}&lt;{{ referee.email }}&gt;{% endif %}</p>
<p>Address:</p>
<div>{{ referee.address|linebreaksbr }}</div>
{% if referee.tel %}<div>{{ referee.tel }}</div>{% endif %}
{% if referee.mobile %}<div>{{ referee.mobile }}</div>{% endif %}
<div><br/></div>

{% if already_requested %}
<p><strong class="ok">PLEASE NOTE: A request has already been sent for this reference</strong></p>
{% endif %}

{% if bad_email %}
  <p>No e-mail address (or an invalid e-mail address) was provided, so the
    referee can't be e-mailed.  If you cannot find out their e-mail address, you
    must manage the reference manually.  If you can find out the e-mail
    address, enter it below and press 'Save' to continue:</p>


  <form method="post" action="">{% csrf_token %}
    {{ emailform.as_p }}
    <div><input type="submit" name="setemail" value="Save" /></div>
  </form>

{% else %}
  {% if is_update and known_email_address %}
  <p>{{ referee.name }} has done a reference for {{ app.officer.first_name }} in the past.</p>
  {% endif %}

  {% if not is_update %}
  <p><strong>{{ referee.name }} has not done a reference for
      {{ app.officer.first_name }} in the past.</strong>  Before requesting this
      reference, you should endeavour to ensure that this person is who the
      applicant claims they are, and <strong>ensure the e-mail address is
      correct</strong>, and that they are happy to do a reference.</p>
  {% endif %}

  {% if is_update and not known_email_address %}
  <p>In the past, "{{ old_referee.name }} &lt;{{ old_referee.email }}&gt;" did a
    reference for {{ app.officer.first_name }}.  If you have confirmed that this
    person's name/email address is now "{{ referee.name }} &lt;{{ referee.email }}&gt;",
    you can ask them to update their reference.</p>
  {% endif %}

  <p>If you need to correct the e-mail address, please edit below and press
  'Save' before continuing:</p>

  <form method="post" action="">{% csrf_token %}
    {{ emailform.as_p }}
    <p><input type="submit" name="setemail" value="Save" /></p>
  </form>

  <hr/>

  <p>The following e-mail, which you can now modify, will be sent to them.
    Make sure you don't modify the link contained in the e-mail.</p>
  <form action="" method="post">{% csrf_token %}
    {{ messageform.as_p }}
    <p>
    <input type="submit" name="send" value="Send" />
    <input type="submit" name="cancel" value="Cancel" />
    </p>
  </form>

{% endif %}

</div>
{% endblock %}
